# Godot 4.x 2DåŠ¨ç”»ç”Ÿæˆæ³¨æ„äº‹é¡¹

## ğŸ“‹ æ¦‚è¿°
æœ¬æ–‡æ¡£è®°å½•äº†åœ¨ Godot 4.x é¡¹ç›®ä¸­æ·»åŠ  AnimatedSprite2D åŠ¨ç”»æ—¶é‡åˆ°çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œä½œä¸ºæœªæ¥å¼€å‘å‚è€ƒã€‚

---

## ğŸš¨ å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: åŠ¨ç”»ä¸æ’­æ”¾ - ä½¿ç”¨å¤–éƒ¨ SpriteFrames èµ„æº

#### âŒ é”™è¯¯åšæ³•
```gdscript
# å°è¯•åˆ›å»ºç‹¬ç«‹çš„ .tres æ–‡ä»¶å¼•ç”¨
[ext_resource type="SpriteFrames" path="res://animations/king_idle.tres" id="king_anim"]

[node name="AnimatedSprite2D" type="AnimatedSprite2D"]
sprite_frames = ExtResource("king_anim")  # âŒ å¯èƒ½å¯¼è‡´æ— æ³•åŠ è½½
autoplay = true
```

**é—®é¢˜ç—‡çŠ¶**:
- è¿è¡Œæ—¶ AnimatedSprite2D æ˜¾ç¤ºç©ºç™½
- æ§åˆ¶å°æ— é”™è¯¯æç¤º
- åŠ¨ç”»èµ„æºå·²åŠ è½½ä½†ä¸æ’­æ”¾

#### âœ… æ­£ç¡®åšæ³•
```gdscript
# ä½¿ç”¨å†…åµŒ SubResource æ–¹å¼
[ext_resource type="Texture2D" path="res://textures/idle_sheet.png" id="idle_texture"]

[sub_resource type="AtlasTexture" id="AtlasTexture_1"]
atlas = ExtResource("idle_texture")
region = Rect2(0, 0, 78, 58)

[sub_resource type="SpriteFrames" id="SpriteFrames_idle"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_1")
}],
"loop": true,
"name": &"idle",
"speed": 8.0
}]

[node name="AnimatedSprite2D" type="AnimatedSprite2D"]
sprite_frames = SubResource("SpriteFrames_idle")  # âœ… ä½¿ç”¨ SubResource
autoplay = &"idle"  # âœ… æ³¨æ„å­—ç¬¦ä¸²æ ¼å¼
```

**ä¸ºä»€ä¹ˆè¿™æ˜¯æ­£ç¡®çš„**:
- Godot 4.x æ¨èä½¿ç”¨å†…åµŒ SubResource
- é¿å…å¤–éƒ¨èµ„æºæ–‡ä»¶åŠ è½½æ—¶æœºé—®é¢˜
- ä¸é¡¹ç›®ç°æœ‰ä»£ç ï¼ˆå¦‚ `coin.tscn`ï¼‰ä¿æŒä¸€è‡´

---

### é—®é¢˜2: autoplay å±æ€§è®¾ç½®é”™è¯¯

#### âŒ é”™è¯¯åšæ³•
```gdscript
autoplay = true  # âŒ åœ¨ Godot 4.x ä¸­æ— æ•ˆ
animation = &"idle"
```

#### âœ… æ­£ç¡®åšæ³•
```gdscript
autoplay = &"idle"  # âœ… ç›´æ¥æŒ‡å®šåŠ¨ç”»åç§°
```

**è¯´æ˜**:
- Godot 4.x ä¸­ `autoplay` åº”è¯¥è®¾ç½®ä¸ºåŠ¨ç”»åç§°å­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ `&"string"` è¯­æ³•ï¼‰
- ä¸éœ€è¦å•ç‹¬è®¾ç½® `animation` å±æ€§

---

### é—®é¢˜3: SpriteFrames æ ¼å¼ä¸å®Œæ•´

#### âŒ é”™è¯¯åšæ³•
```gdscript
[resource]
animations = [{
"loop": true,
"name": &"idle",
"speed": 8.0,
"frames": []  # âŒ ç¼ºå°‘å¸§æ•°æ®
}]
```

#### âœ… æ­£ç¡®åšæ³•
```gdscript
[sub_resource type="SpriteFrames" id="SpriteFrames_idle"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2")
}],
"loop": true,
"name": &"idle",
"speed": 8.0
}]
```

**å¿…éœ€å­—æ®µ**:
- `frames`: å¿…é¡»åŒ…å«è‡³å°‘ä¸€å¸§
- æ¯å¸§å¿…é¡»æœ‰ `duration` å’Œ `texture`
- `name`: åŠ¨ç”»åç§°
- `speed`: æ’­æ”¾é€Ÿåº¦ (FPS)
- `loop`: æ˜¯å¦å¾ªç¯

---

## ğŸ“ æ ‡å‡†æµç¨‹ï¼šä¸ºè§’è‰²æ·»åŠ åŠ¨ç”»

### æ­¥éª¤1: å‡†å¤‡åºåˆ—å¸§å›¾é›†
ç¡®ä¿ä½ æœ‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¸§çš„æ°´å¹³/å‚ç›´åºåˆ—å›¾é›†ï¼š
```
Idle (78x58).png - æ¯å¸§ 78x58 åƒç´ ï¼Œæ°´å¹³æ’åˆ—
```

### æ­¥éª¤2: åˆ›å»ºåœºæ™¯æ–‡ä»¶ç»“æ„

åœ¨ `.tscn` æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹é¡ºåºå®šä¹‰èµ„æºï¼š

1. **çº¹ç†èµ„æº (ext_resource)** - åŠ è½½åŸå›¾é›†
2. **AtlasTexture å­èµ„æº (sub_resource)** - ä¸ºæ¯ä¸€å¸§åˆ›å»ºåˆ‡åˆ†åŒºåŸŸ
3. **SpriteFrames å­èµ„æº (sub_resource)** - ç»„è£…æ‰€æœ‰å¸§
4. **AnimatedSprite2D èŠ‚ç‚¹** - ä½¿ç”¨ä¸Šè¿°èµ„æº

### æ­¥éª¤3: è®¡ç®—åŒºåŸŸåæ ‡

å¯¹äºæ°´å¹³åºåˆ—å¸§å›¾é›†ï¼š
```gdscript
å¸§å°ºå¯¸ = Vector2(width, height)
ç¬¬nå¸§çš„ region = Rect2(n * width, 0, width, height)
```

ç¤ºä¾‹ (11å¸§ï¼Œæ¯å¸§78x58):
```gdscript
Frame 0: Rect2(0, 0, 78, 58)
Frame 1: Rect2(78, 0, 78, 58)
Frame 2: Rect2(156, 0, 78, 58)
...
Frame 10: Rect2(780, 0, 78, 58)
```

### æ­¥éª¤4: é…ç½® AnimatedSprite2D

```gdscript
[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(x, y)  # è°ƒæ•´ä½ç½®
scale = Vector2(-1, 1)    # å¦‚éœ€æ°´å¹³ç¿»è½¬
sprite_frames = SubResource("SpriteFramesåŠ¨ç”»å")
autoplay = &"åŠ¨ç”»å"
```

### æ­¥éª¤5: æµ‹è¯•éªŒè¯

1. åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€åœºæ™¯
2. é€‰æ‹© AnimatedSprite2D èŠ‚ç‚¹
3. åœ¨åº•éƒ¨é¢æ¿çš„ SpriteFrames ç¼–è¾‘å™¨ä¸­é¢„è§ˆ
4. è¿è¡Œæ¸¸æˆæµ‹è¯•

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥åŠ¨ç”»æ˜¯å¦æ­£ç¡®åŠ è½½

åœ¨è„šæœ¬ä¸­æ·»åŠ è°ƒè¯•ä»£ç ï¼š
```gdscript
func _ready() -> void:
    var sprite = $AnimatedSprite2D
    print("åŠ¨ç”»åˆ—è¡¨: ", sprite.sprite_frames.get_animation_names())
    print("å½“å‰åŠ¨ç”»: ", sprite.animation)
    print("å¸§æ•°: ", sprite.sprite_frames.get_frame_count("idle"))
```

### å¸¸è§é—®é¢˜æ’æŸ¥

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| æ˜¾ç¤ºç©ºç™½ | çº¹ç†è·¯å¾„é”™è¯¯ | æ£€æŸ¥ `.import` æ–‡ä»¶ä¸­çš„ UID |
| åªæ˜¾ç¤ºç¬¬ä¸€å¸§ | autoplay æœªè®¾ç½® | è®¾ç½® `autoplay = &"åŠ¨ç”»å"` |
| åŠ¨ç”»å¤ªå¿«/å¤ªæ…¢ | speed å€¼ä¸å½“ | è°ƒæ•´ SpriteFrames çš„ speed |
| å¸§é¡ºåºé”™è¯¯ | region åæ ‡é”™è¯¯ | é‡æ–°è®¡ç®—æ¯å¸§çš„ Rect2 |

---

## ğŸ“š å‚è€ƒèµ„æº

### é¡¹ç›®ä¸­çš„æ­£ç¡®ç¤ºä¾‹
- `scenes/items/coin.tscn` - ç¡¬å¸æ—‹è½¬åŠ¨ç”»
- `scenes/NPC/shop_keeper.tscn` - å›½ç‹idleåŠ¨ç”»

### æ¨èå·¥å…·

#### å›¾é›†å¤„ç†
- **TexturePacker** - è‡ªåŠ¨æ‰“åŒ…åºåˆ—å¸§
- **Aseprite** - åƒç´ åŠ¨ç”»ç¼–è¾‘å™¨ï¼Œå¯å¯¼å‡ºå›¾é›†

#### è¾…åŠ©è„šæœ¬
é¡¹ç›®åŒ…å«å·¥å…·è„šæœ¬ `Scripts/tools/create_king_animation.gd`ï¼Œå¯ç”¨äºè‡ªåŠ¨ç”ŸæˆåŠ¨ç”»é…ç½®ã€‚

---

## âš ï¸ Godot 4.x ç‰¹å®šæ³¨æ„äº‹é¡¹

### ä¸ Godot 3.x çš„åŒºåˆ«

| ç‰¹æ€§ | Godot 3.x | Godot 4.x |
|------|-----------|-----------|
| autoplay | `autoplay = true` | `autoplay = &"anim_name"` |
| StringName | ä½¿ç”¨ `""` | æ¨è `&""` |
| SpriteFrames | å¯ä½¿ç”¨å¤–éƒ¨èµ„æº | æ¨èå†…åµŒ SubResource |

### èµ„æºå¯¼å…¥

ç¡®ä¿å›¾é›†å·²æ­£ç¡®å¯¼å…¥ï¼š
- æ£€æŸ¥ `.import` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- éªŒè¯ UID æ˜¯å¦åŒ¹é…
- å¿…è¦æ—¶é‡æ–°å¯¼å…¥ï¼ˆå³é”® â†’ Reimportï¼‰

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. åˆç†è®¾ç½® FPS
- ç®€å•åŠ¨ç”»: 6-8 FPS
- å¤æ‚åŠ¨ç”»: 10-12 FPS
- é¿å…è¶…è¿‡ 15 FPSï¼ˆå¤§å¤šæ•°2Dæ¸¸æˆä¸éœ€è¦ï¼‰

### 2. ä½¿ç”¨å›¾é›†è€Œéå•å¸§
- âœ… ä¸€ä¸ªå›¾é›†åŒ…å«æ‰€æœ‰å¸§
- âŒ å¤šä¸ªå•ç‹¬çš„çº¹ç†æ–‡ä»¶

### 3. å¾ªç¯åŠ¨ç”»
- idleã€walkç­‰åº”è®¾ç½® `"loop": true`
- attackã€deathç­‰åº”è®¾ç½® `"loop": false`

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

æ·»åŠ æ–°åŠ¨ç”»å‰ï¼Œç¡®ä¿ï¼š

- [ ] å›¾é›†æ–‡ä»¶å·²å¯¼å…¥ï¼ˆæ£€æŸ¥ `.import` æ–‡ä»¶ï¼‰
- [ ] æ¯å¸§å°ºå¯¸ä¸€è‡´
- [ ] è®¡ç®—äº†æ­£ç¡®çš„ region åæ ‡
- [ ] ä½¿ç”¨ SubResource è€Œéå¤–éƒ¨æ–‡ä»¶
- [ ] autoplay è®¾ç½®æ­£ç¡®ï¼ˆ`&"åŠ¨ç”»å"`ï¼‰
- [ ] åœ¨ç¼–è¾‘å™¨ä¸­é¢„è§ˆè¿‡åŠ¨ç”»
- [ ] æµ‹è¯•äº†æ¸¸æˆè¿è¡Œæ•ˆæœ

---

## ğŸ”§ å¿«é€Ÿæ¨¡æ¿

å¤åˆ¶æ­¤æ¨¡æ¿å¿«é€Ÿåˆ›å»ºåŠ¨ç”»ï¼š

```gdscript
[gd_scene load_steps=X format=3 uid="uid://ä½ çš„uid"]

[ext_resource type="Texture2D" path="res://ä½ çš„å›¾é›†.png" id="atlas_texture"]

[sub_resource type="AtlasTexture" id="AtlasTexture_0"]
atlas = ExtResource("atlas_texture")
region = Rect2(0, 0, FRAME_WIDTH, FRAME_HEIGHT)

[sub_resource type="AtlasTexture" id="AtlasTexture_1"]
atlas = ExtResource("atlas_texture")
region = Rect2(FRAME_WIDTH, 0, FRAME_WIDTH, FRAME_HEIGHT)

# ... æ·»åŠ æ›´å¤šå¸§ ...

[sub_resource type="SpriteFrames" id="SpriteFramesåŠ¨ç”»å"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1")
}],
"loop": true,
"name": &"åŠ¨ç”»å",
"speed": 8.0
}]

[node name="ä½ çš„èŠ‚ç‚¹" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFramesåŠ¨ç”»å")
autoplay = &"åŠ¨ç”»å"
```

**æ›¿æ¢å˜é‡**:
- `ä½ çš„uid` - ä½¿ç”¨ç¼–è¾‘å™¨ç”Ÿæˆçš„ UID
- `ä½ çš„å›¾é›†.png` - ä½ çš„å›¾é›†è·¯å¾„
- `FRAME_WIDTH/HEIGHT` - å•å¸§å°ºå¯¸
- `åŠ¨ç”»å` - åŠ¨ç”»åç§°ï¼ˆå¦‚ idle, walkï¼‰

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°æœ¬æ–‡æ¡£æœªè¦†ç›–çš„é—®é¢˜ï¼š

1. æŸ¥çœ‹ Godot å®˜æ–¹æ–‡æ¡£: https://docs.godotengine.org/
2. å‚è€ƒé¡¹ç›®ä¸­å·²æœ‰çš„åŠ¨ç”»å®ç°ï¼ˆ`coin.tscn`, `bat.tscn` ç­‰ï¼‰
3. æ£€æŸ¥ Godot ç¼–è¾‘å™¨è¾“å‡ºé¢æ¿çš„é”™è¯¯ä¿¡æ¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-02-11
**é€‚ç”¨ç‰ˆæœ¬**: Godot 4.5+
**ç»´æŠ¤è€…**: é¡¹ç›®å¼€å‘å›¢é˜Ÿ
