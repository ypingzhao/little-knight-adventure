# æ•Œäººè¡Œä¸ºé—®é¢˜æ€»ç»“

> **ç‰ˆæœ¬**: 1.0
> **æ—¥æœŸ**: 2025-02-12
> **é€‚ç”¨é¡¹ç›®**: Little Knight Adventure v0.5
> **é—®é¢˜ç±»å‹**: æ•Œäººç§»åŠ¨ã€å—å‡»ã€æ­»äº¡é€»è¾‘

---

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

åœ¨ä¿®å¤ `slime_green.gd` æ•Œäººæ—¶ï¼Œå› ä¸º**è¿‡åº¦ä¿®æ”¹æ­£å¸¸å·¥ä½œçš„ä»£ç **ï¼Œå¯¼è‡´å¼•å…¥å¤šä¸ªæ–°é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„"æŠŠæ­£ç¡®çš„æ”¹åäº†"æ¡ˆä¾‹ã€‚

**æ ¹æœ¬åŸå› **ï¼š
- âŒ æ²¡æœ‰æŒ‰ç…§æ˜ç¡®çš„ä¿®æ”¹è¯·æ±‚è¿›è¡Œæ›´æ”¹
- âŒ ä¸»åŠ¨"æ”¹è¿›"äº†åŸæœ¬æ­£å¸¸å·¥ä½œçš„é€»è¾‘
- âŒ å¤šæ¬¡ä¿®æ”¹å¯¼è‡´é—®é¢˜å¤æ‚åŒ–ï¼Œéš¾ä»¥å®šä½
- âœ… åº”è¯¥ï¼šåªä¿®å¤æ˜ç¡®æŠ¥å‘Šçš„é—®é¢˜ï¼ˆæ·»åŠ ç¼ºå¤±çš„æ–¹æ³•ï¼‰

---

## âŒ é—®é¢˜åˆ—è¡¨

### 1. green slime æ— æ³•ç§»åŠ¨

**ç—‡çŠ¶**:
- æ•Œäººåˆå§‹åŒ–ååŸåœ°ä¸åŠ¨ï¼Œæ²¡æœ‰åº”ç”¨ç§»åŠ¨

**æ ¹æœ¬åŸå› **:
- ç¼ºå°‘ `move_and_slide()` è°ƒç”¨
- CharacterBody2D éœ€è¦æ˜¾å¼è°ƒç”¨æ­¤æ–¹æ³•æ¥åº”ç”¨ velocity

**ä¿®å¤**:
```gdscript
func _physics_process(delta: float) -> void:
    # ... è®¾ç½® velocity ...
    move_and_slide()  # âœ… æ·»åŠ æ­¤è¡Œ
```

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**å½±å“**: æ•Œäººå®Œå…¨æ— æ³•ç§»åŠ¨

---

### 2. æœå‘å’Œç§»åŠ¨æ–¹å‘ä¸ä¸€è‡´

**ç—‡çŠ¶**:
- sprite.flip_h ä¸å®é™…ç§»åŠ¨æ–¹å‘ç›¸å

**é—®é¢˜ä»£ç **:
```gdscript
# âŒ é”™è¯¯ï¼švelocity.x è¢«è®¾ç½®ä¸¤æ¬¡
if ray_cast_right.is_colliding():
    velocity.x = -abs(velocity.x)  # ç¬¬ä¸€æ¬¡è®¾ç½®
    _flip_direction()             # æ”¹å˜ direction
elif ray_cast_left.is_colliding():
    velocity.x = abs(velocity.x)   # ç¬¬ä¸€æ¬¡è®¾ç½®
    _flip_direction()             # æ”¹å˜ direction

# ç»Ÿä¸€è®¾ç½®
velocity.x = direction * SPEED  # ç¬¬äºŒæ¬¡è®¾ç½®ï¼ˆè¦†ç›–ç¬¬ä¸€æ¬¡ï¼‰
```

**Lesson Learnt**:
- **å˜é‡è®¾ç½®çš„å•ä¸€èŒè´£åŸåˆ™**
  - velocity.x åœ¨åŒä¸€å¸§å†…è¢«å¤šæ¬¡è®¾ç½®ä¼šäº§ç”Ÿè¦†ç›–
  - åº”è¯¥ï¼šå…ˆä¿®æ”¹ directionï¼ˆçŠ¶æ€å˜é‡ï¼‰ï¼Œæœ€åç»Ÿä¸€è®¾ç½® velocityï¼ˆç‰©ç†å˜é‡ï¼‰
  - å£è¯€ï¼š"è®¡ç®— â†’ èµ‹å€¼çŠ¶æ€ â†’ åº”ç”¨ç‰©ç†"

**ä¿®å¤**:
```gdscript
# âœ… æ­£ç¡®ï¼šåªä¿®æ”¹ directionï¼Œä¸ä¿®æ”¹ velocity.x
if ray_cast_right.is_colliding():
    _flip_direction()
elif ray_cast_left.is_colliding():
    _flip_direction()

# ç»Ÿä¸€åœ¨æœ€åè®¾ç½®é€Ÿåº¦
velocity.x = direction * SPEED
```

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­
**å½±å“**: æ•Œäººç§»åŠ¨æ–¹å‘é”™è¯¯

---

### 3. æ­»äº¡ç¬é—´æ¶ˆå¤±ï¼Œæ²¡æœ‰æ’­æ”¾åŠ¨ç”»

**ç—‡çŠ¶**:
- æ•Œäººå—åˆ°è‡´å‘½ä¼¤å®³åç«‹å³æ¶ˆå¤±
- æ²¡æœ‰æ’­æ”¾ "die" åŠ¨ç”»
- æ²¡æœ‰é—ªçƒæ•ˆæœ

**é—®é¢˜ä»£ç **:
```gdscript
func take_damage(_amount:int)->void:
    # ...
    elif slime_hp <= 0:
        start_invulnerability()  # await 1ç§’åŠ¨ç”»
        hit_box.set_deferred("monitorable", false)
    if slime_hp <= 0:
        queue_free()  # âŒ ç«‹å³åˆ é™¤ï¼Œä¸ç­‰åŠ¨ç”»å®Œæˆ
```

**Lesson Learnt**:
- **å¼‚æ­¥åŠ¨ç”»ä¸å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå†²çª**
  - `await` ä¸ä¼šé˜»å¡åç»­ä»£ç æ‰§è¡Œ
  - `queue_free()` ç«‹å³æ‰§è¡Œï¼Œä¸ç­‰ await å®Œæˆ
  - æ¶‰åŠ await çš„åŠ¨ç”»åº”è¯¥å°è£…åœ¨ä¸“é—¨çš„å‡½æ•°ä¸­
  - å£è¯€ï¼š"å¼‚æ­¥è¿›ï¼Œå¼‚æ­¥å‡º"ï¼ˆawait å°è£…åœ¨åŒä¸€ä¸ªå‡½æ•°ï¼‰

**ä¿®å¤**:
```gdscript
func take_damage(_amount:int)->void:
    # ...
    elif slime_hp <= 0:
        hit_box.set_deferred("monitorable", false)
        die()  # âœ… è°ƒç”¨ä¸“é—¨çš„æ­»äº¡å‡½æ•°

func die() -> void:
    dead = true
    set_physics_process(false)  # âœ… åœæ­¢ç‰©ç†æ›´æ–°
    hit_box.set_deferred("monitorable", false)
    animated_sprite.play("die")
    await animated_sprite.animation_finished
    print("die animation finished, queue_free")  # âœ… è¯Šæ–­æ—¥å¿—
    queue_free()
```

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**å½±å“**: æ¸¸æˆä½“éªŒå·®ï¼Œç©å®¶çœ‹ä¸åˆ°æ­»äº¡æ•ˆæœ

---

### 4. è¾¹ç¼˜ä¸è½¬å‘ï¼Œä»è¾¹ç¼˜æ‰è½

**ç—‡çŠ¶**:
- æ•Œäººèµ°åˆ°å¹³å°è¾¹ç¼˜
- æ²¡æœ‰æ‰å¤´ï¼Œç»§ç»­ç§»åŠ¨æ‰å‡ºå¹³å°

**é—®é¢˜ä»£ç **:
```gdscript
# âŒ é”™è¯¯ï¼šdirection è¢«ç¿»è½¬ä¸¤æ¬¡
if not ray_cast_down_a.is_colliding() or not ray_cast_down_b.is_colliding():
    direction *= -1          # æ‰‹åŠ¨ç¿»è½¬ï¼ˆ1 â†’ -1ï¼‰
    _flip_direction()      # å†…éƒ¨åˆç¿»è½¬ï¼ˆ-1 â†’ 1ï¼‰= æ²¡å˜ï¼
```

**æ ¹æœ¬åŸå› **:
- `_flip_direction()` å†…éƒ¨å·²ç»æœ‰ `direction *= -1`
- å¤–éƒ¨å†æ‰‹åŠ¨ä¿®æ”¹ä¸€æ¬¡ï¼Œå¯¼è‡´ç¿»è½¬ä¸¤æ¬¡æŠµæ¶ˆ

**Lesson Learntï¼ˆè¡¥å……ç¬¬3æ¡ï¼‰**:
- **çŠ¶æ€å˜é‡çš„ä¿®æ”¹åº”è¯¥é›†ä¸­**
  - åœ¨è°ƒç”¨å‡½æ•°å‰æ‰‹åŠ¨ä¿®æ”¹çŠ¶æ€å˜é‡
  - è€Œå‡½æ•°å†…éƒ¨åˆä¿®æ”¹åŒä¸€ä¸ªå˜é‡
  - å¯¼è‡´ä¿®æ”¹è¢«æŠµæ¶ˆæˆ–äº§ç”Ÿæ„å¤–ç»“æœ
  - å£è¯€ï¼š"è¦ç¿»è½¬ï¼Œè°ƒå‡½æ•°ï¼Œåˆ«æ‰‹åŠ¨æ”¹å€¼"

**ä¿®å¤**:
```gdscript
# âœ… æ­£ç¡®ï¼šåªè°ƒç”¨ç¿»è½¬å‡½æ•°
if not ray_cast_down_a.is_colliding() or not ray_cast_down_b.is_colliding():
    _flip_direction()  # âœ… åªè°ƒç”¨ä¸€æ¬¡
```

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**å½±å“**: æ•Œäººè¡Œä¸ºå¼‚å¸¸ï¼Œä»å¹³å°æ‰è½

---

## ğŸ“ æ ¸å¿ƒæ•™è®­

### ğŸ”´ æœ€ä¸¥é‡çš„æ•™è®­

**ä¸è¦æ“…è‡ªä¿®æ”¹æ²¡æœ‰æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„ä»£ç **

è¿™æ˜¯æœ¬æ¡ˆä¾‹æœ€å…³é”®çš„æ•™è®­ï¼š

1. **åŸå§‹ä»£ç å¯èƒ½æ˜¯æ­£å¸¸å·¥ä½œçš„**
   - ç”¨æˆ·åªæŠ¥å‘Š"æ— æ³•ç§»åŠ¨"
   - ä½†å…¶ä»–é€»è¾‘ï¼ˆç¢°æ’æ£€æµ‹ã€è¾¹ç¼˜è½¬å‘ï¼‰å¯èƒ½éƒ½æ˜¯æ­£ç¡®çš„
   - "æ”¹è¿›"åè€Œå¼•å…¥æ–°é—®é¢˜

2. **ä¿®æ”¹åº”è¯¥æœ€å°åŒ–**
   - âŒ é”™è¯¯ï¼šä¸€æ¬¡ä¿®æ”¹äº†ç¢°æ’æ£€æµ‹ã€æ­»äº¡é€»è¾‘ã€è¾¹ç¼˜è½¬å‘ç­‰å¤šä¸ªåœ°æ–¹
   - âœ… æ­£ç¡®ï¼šåªæ·»åŠ ç¼ºå¤±çš„ `move_and_slide()` è°ƒç”¨

3. **æ·»åŠ å‰å…ˆè¯¢é—®**
   - å¦‚æœéœ€è¦æ·»åŠ /ä¿®æ”¹åŠŸèƒ½
   - å…ˆè¯´æ˜åŸå› ï¼š"æˆ‘å‘ç°è¿™é‡Œç¼ºå°‘ xxxï¼Œæ˜¯å¦éœ€è¦æ·»åŠ ï¼Ÿ"
   - ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†æ‰§è¡Œ

4. **æä¾›è¯Šæ–­æ–¹æ¡ˆè€Œéç›´æ¥ä¿®æ”¹**
   - å¦‚æœé—®é¢˜ä¸ç¡®å®š
   - å…ˆæä¾›æ£€æŸ¥æ­¥éª¤ï¼š"è¯·æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº† move_and_slide()"
   - è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ä»£ç 

### ä¸ºä»€ä¹ˆä¼šçŠ¯é”™

**é”™è¯¯çš„æ€ç»´æ¨¡å¼**:
1. çœ‹åˆ°ä»£ç æ„Ÿè§‰"ä¸ä¼˜é›…" â†’ æƒ³æ”¹è¿›
2. çœ‹åˆ° bat.gd ç”¨äº†æŸç§å†™æ³• â†’ è§‰å¾—åº”è¯¥ç»Ÿä¸€
3. çœ‹åˆ° boss æœ‰é—ªçƒåŠ¨ç”» â†’ è§‰å¾—åº”è¯¥åŠ åˆ° slime
4. å¤šæ¬¡ä¿®æ”¹å â†’ å¿˜è®°äº†å“ªäº›æ˜¯åŸå§‹é€»è¾‘

**æ­£ç¡®çš„æ€ç»´æ¨¡å¼**:
1. ç”¨æˆ·æŠ¥å‘Šä»€ä¹ˆé—®é¢˜ â†’ åªä¿®å¤è¿™ä¸ªé—®é¢˜
2. ä¸ç¡®å®šæ˜¯å¦æœ‰å…¶ä»–é—®é¢˜ â†’ ä¸ä¸»åŠ¨ä¿®æ”¹
3. çœ‹åˆ°ä»£ç é£æ ¼ä¸ç»Ÿä¸€ â†’ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦ç»Ÿä¸€
4. æ¯æ¬¡ä¿®æ”¹ â†’ è®°å½•ä¿®æ”¹å†…å®¹å’ŒåŸå› 

### ä¸‹æ¬¡ä¿®æ”¹åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|-------|-------|
| **åªä¿®æ”¹æ˜ç¡®è¦æ±‚çš„éƒ¨åˆ†** | ç”¨æˆ·è¯´"æ— æ³•ç§»åŠ¨" â†’ åªæ£€æŸ¥ç§»åŠ¨ç›¸å…³ä»£ç  |
| **æœ€å°åŒ–æ”¹åŠ¨** | ä¸€æ¬¡åªè§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œä¸è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªåœ°æ–¹ |
| **æ·»åŠ å‰å…ˆè¯¢é—®** | éœ€è¦æ·»åŠ /ä¿®æ”¹åŠŸèƒ½ï¼Œå…ˆè¯´æ˜åŸå› å¹¶ç­‰å¾…ç¡®è®¤ |
| **æä¾›è¯Šæ–­æ–¹æ¡ˆ** | é—®é¢˜ä¸ç¡®å®šæ—¶ï¼Œå…ˆæä¾›æ£€æŸ¥æ­¥éª¤è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ |

---

## ğŸ“Š å½±å“ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|-----|------|
| ä¿®æ”¹æ¬¡æ•° | 4+ æ¬¡ |
| å¼•å…¥é—®é¢˜æ•° | 3 ä¸ª |
| æµªè´¹ tokens | å¤§é‡ |
| æœ€ç»ˆçŠ¶æ€ | éœ€è¦å›æ»šæˆ–è¿›ä¸€æ­¥ä¿®å¤ |

---

## âœ… æ­£ç¡®çš„æ•Œäººè¡Œä¸ºå‚è€ƒ

### bat.gdï¼ˆå·¥ä½œæ­£å¸¸ï¼‰

**ç§»åŠ¨é€»è¾‘**:
```gdscript
func _physics_process(delta: float) -> void:
    velocity = Vector2.LEFT * speed  # âœ… ç›´æ¥è®¾ç½® velocity
    animated_sprite.flip_h = true    # âœ… ç›´æ¥è®¾ç½®ç¿»è½¬
    velocity.y = sine_amplitude * sin(_life_time * sine_frequency * TAU)
    move_and_slide()  # âœ… åº”ç”¨ç§»åŠ¨
```

**å—ä¼¤é€»è¾‘**:
```gdscript
func take_damage(_amount:int)->void:
    bat_hp -= _amount
    if bat_hp >0:
        start_invulnerability()
    elif bat_hp <= 0:
        start_invulnerability()  # âœ… åŒ…å«é—ªçƒåŠ¨ç”»
        hit_box.set_deferred("monitorable",false)
        die()
```

**æ­»äº¡é€»è¾‘**:
```gdscript
func die()->void:
    dead = true
    animated_sprite.play("die")
    await animated_sprite.animation_finished  # âœ… ç­‰å¾…åŠ¨ç”»
    queue_free()
```

### slime_purple_boss.gdï¼ˆå®Œæ•´å®ç°ï¼‰

**å®Œæ•´çš„ `start_invulnerability()`**:
```gdscript
func start_invulnerability() -> void:
    invulnerable = true
    hurt_sound.play()
    hit_box.set_deferred("monitorable",false)
    # âœ… é—ªçƒåŠ¨ç”»ï¼š0.1 ç§’ Ã— 10 æ¬¡ = 1 ç§’
    var tween = create_tween().set_loops(10)
    tween.tween_property(animated_sprite, "modulate:a", 0.2, 0.05)
    tween.tween_property(animated_sprite, "modulate:a", 1.0, 0.05)
    await get_tree().create_timer(1.0).timeout
    invulnerable = false
    hit_box.set_deferred("monitorable",true)
    invulnerability_ended.emit()
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ tween åˆ›å»ºé—ªçƒåŠ¨ç”»
- await å®Œæ•´çš„ 1 ç§’æ— æ•Œæ—¶é—´
- æœ€åè®¾ç½®å›å¯è¢«å‡»ä¸­çŠ¶æ€
- å‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»–ç³»ç»Ÿ

---

## ğŸ” è¯Šæ–­æ–¹æ³•

### æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨å…³é”®ä½ç½®æ·»åŠ  print è¯­å¥ï¼š

```gdscript
func die() -> void:
    print("die active!")  # âœ… æ­»äº¡å¼€å§‹
    set_physics_process(false)
    animated_sprite.play("die")
    await animated_sprite.animation_finished
    print("die animation finished, queue_free")  # âœ… åŠ¨ç”»å®Œæˆ
    queue_free()
```

**è¯Šæ–­æ­¥éª¤**:
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦è¾“å‡º "die active!"
2. æ£€æŸ¥æ˜¯å¦è¾“å‡º "die animation finished"
3. å¦‚æœåªæœ‰ç¬¬ä¸€è¡Œï¼Œè¯´æ˜åŠ¨ç”»æœªå®Œæˆ
4. å¦‚æœä¸¤è¡Œéƒ½æ²¡æœ‰ï¼Œè¯´æ˜ die() æœªè°ƒç”¨

### æ£€æŸ¥èŠ‚ç‚¹é…ç½®

1. ç¡®è®¤ `@onready var animated_sprite: AnimatedSprite2D = $AnimatedSprite2D`
   - è·¯å¾„å¿…é¡»åŒ¹é…åœºæ™¯æ ‘
2. æ£€æŸ¥ AnimatedSprite2D èŠ‚ç‚¹æ˜¯å¦æœ‰ "die" åŠ¨ç”»
   - åœ¨ç²¾çµè¡¨ä¸­ç¡®è®¤åŠ¨ç”»åç§°
3. æµ‹è¯•åŠ¨ç”»æ—¶é•¿
   - ç¡®ä¿ animation_finished ä¿¡å·èƒ½è§¦å‘

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2025-02-12)
- åˆå§‹ç‰ˆæœ¬
- è®°å½• green slime æ•Œäººè¡Œä¸ºé—®é¢˜
- æ€»ç»“æ ¸å¿ƒæ•™è®­ï¼šä¸è¦æ“…è‡ªä¿®æ”¹ä»£ç 

---

## ğŸ¯ åˆ›å»ºç›®çš„

è®°å½•æ•Œäººè¡Œä¸ºå¼€å‘ä¸­çš„é—®é¢˜ï¼Œé¿å…ï¼š
- è¿‡åº¦ä¿®æ”¹æ­£å¸¸å·¥ä½œçš„ä»£ç 
- å¼•å…¥æ–°çš„é—®é¢˜è€Œéä¿®å¤é—®é¢˜
- æµªè´¹å¤§é‡è°ƒè¯•æ—¶é—´

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¼€å‘é—®é¢˜æ±‡æ€».md](./å¼€å‘é—®é¢˜æ±‡æ€».md) - æ‰€æœ‰é—®é¢˜æ€»ç›®å½•
- [å¼€å‘é—®é¢˜æ±‡æ€».md#8-æ•Œäººè¡Œä¸ºé—®é¢˜](./å¼€å‘é—®é¢˜æ±‡æ€».md#8-æ•Œäººè¡Œä¸ºé—®é¢˜) - æœ¬ç« èŠ‚åœ¨æ€»ç›®å½•ä¸­çš„ä½ç½®
